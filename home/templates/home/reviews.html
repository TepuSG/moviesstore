{% extends 'base.html' %}
{% load static %}
{% block content %}
	<div class="container mt-4">
		<h2>All Reviews</h2>
		<p class="text-muted">Showing reviews from all movies. Newest first.</p>

		{% if template_data.page_obj.object_list %}
			<div class="row">
						{% for review in template_data.page_obj.object_list %}
					<div class="col-md-6 mb-3">
						<div class="card">
							<div class="card-body">
								<h5 class="card-title">{{ review.movie.name }}</h5>
										<h6 class="card-subtitle mb-2 text-muted">Review by {{ review.user.username }} — {{ review.date|date:"M d, Y H:i" }} — Rating: {{ review.rating }} / 5</h6>
										<p class="card-text">{{ review.comment }}</p>
										<div>
																  <form method="post" action="{% url 'movies.toggle_like' id=review.movie.id review_id=review.id %}" style="display:inline" class="ajax-like-form">
																	{% csrf_token %}
																	{% if user.is_authenticated and user in review.likes.all %}
																		<button type="submit" class="btn btn-sm btn-success">Unlike ({{ review.likes.count }})</button>
																	{% else %}
																		<button type="submit" class="btn btn-sm btn-outline-primary">Like ({{ review.likes.count }})</button>
																	{% endif %}
																</form>
											<a href="{% url 'movies.show' id=review.movie.id %}" class="card-link">View movie</a>
										</div>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>

			<nav aria-label="Page navigation">
				<ul class="pagination">
					{% if template_data.page_obj.has_previous %}
						<li class="page-item">
							<a class="page-link" href="?page={{ template_data.page_obj.previous_page_number }}">Previous</a>
						</li>
					{% else %}
						<li class="page-item disabled"><span class="page-link">Previous</span></li>
					{% endif %}

					<li class="page-item disabled"><span class="page-link">Page {{ template_data.page_obj.number }} of {{ template_data.page_obj.paginator.num_pages }}</span></li>

					{% if template_data.page_obj.has_next %}
						<li class="page-item">
							<a class="page-link" href="?page={{ template_data.page_obj.next_page_number }}">Next</a>
						</li>
					{% else %}
						<li class="page-item disabled"><span class="page-link">Next</span></li>
					{% endif %}
				</ul>
			</nav>

		{% else %}
			<p>No reviews yet.</p>
		{% endif %}
	</div>

{% endblock content %}
